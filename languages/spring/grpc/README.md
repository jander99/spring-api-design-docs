# Spring Boot gRPC Implementation Guide

> **ğŸ“– Reading Guide**
> **â±ï¸ Reading Time:** 8 minutes | **ğŸ¯ Level:** Beginner to Intermediate
> **ğŸ“‹ Prerequisites:** Spring Boot 3.x knowledge, basic understanding of gRPC
> **ğŸ¯ Key Topics:** Spring gRPC setup â€¢ Service implementation â€¢ Client configuration â€¢ Testing
> **ğŸ“Š Complexity:** [Pending analysis] â€¢ [Pending]% technical density â€¢ [Pending]

This guide covers implementing gRPC services and clients with Spring Boot 3.x using the `grpc-spring-boot-starter` library.

---

## Overview

This implementation guide shows you how to build production-ready gRPC services with Spring Boot. You'll learn:

- **Server implementation** - Building gRPC services with `@GrpcService`
- **Client configuration** - Consuming gRPC services with `@GrpcClient`
- **Testing strategies** - Unit, integration, and end-to-end testing
- **Observability** - Metrics, tracing, and health checks
- **Security** - Authentication, authorization, and TLS

**Library used:** `net.devh:grpc-spring-boot-starter:3.1.0.RELEASE`

---

## Architecture Overview

### Spring gRPC Stack

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Spring Boot Application Layer         â”‚
â”‚   (@Service, @Component, business logic)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   gRPC Service Layer (@GrpcService)     â”‚
â”‚   - OrderServiceImpl                    â”‚
â”‚   - InventoryServiceImpl                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Interceptor Layer                     â”‚
â”‚   - Authentication                      â”‚
â”‚   - Logging & Tracing                   â”‚
â”‚   - Error Handling                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   grpc-spring-boot-starter              â”‚
â”‚   (Auto-configuration, Server, Client)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   gRPC Java (io.grpc:grpc-*)            â”‚
â”‚   (Protocol implementation)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Project Structure

```
src/main/
â”œâ”€â”€ proto/                           # Protobuf definitions
â”‚   â””â”€â”€ order_service.proto
â”œâ”€â”€ java/com/example/order/
â”‚   â”œâ”€â”€ grpc/                        # gRPC layer
â”‚   â”‚   â”œâ”€â”€ OrderServiceGrpc.java   # Generated by protoc
â”‚   â”‚   â”œâ”€â”€ OrderServiceImpl.java   # Your implementation
â”‚   â”‚   â””â”€â”€ interceptors/
â”‚   â”‚       â”œâ”€â”€ AuthInterceptor.java
â”‚   â”‚       â””â”€â”€ LoggingInterceptor.java
â”‚   â”œâ”€â”€ service/                     # Business logic layer
â”‚   â”‚   â””â”€â”€ OrderService.java
â”‚   â”œâ”€â”€ repository/                  # Data access layer
â”‚   â”‚   â””â”€â”€ OrderRepository.java
â”‚   â””â”€â”€ config/                      # Configuration
â”‚       â””â”€â”€ GrpcConfig.java
â””â”€â”€ resources/
    â””â”€â”€ application.yml              # gRPC configuration

src/test/
â”œâ”€â”€ java/com/example/order/
â”‚   â””â”€â”€ grpc/
â”‚       â”œâ”€â”€ OrderServiceImplTest.java      # Unit tests
â”‚       â””â”€â”€ OrderServiceIntegrationTest.java # Integration tests
```

---

## Quick Start

### 1. Add Dependencies

**Maven:**
```xml
<dependencies>
    <!-- Spring Boot Starter -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter</artifactId>
        <version>3.2.0</version>
    </dependency>

    <!-- gRPC Spring Boot Starter -->
    <dependency>
        <groupId>net.devh</groupId>
        <artifactId>grpc-spring-boot-starter</artifactId>
        <version>3.1.0.RELEASE</version>
    </dependency>

    <!-- gRPC Services (Server-side) -->
    <dependency>
        <groupId>net.devh</groupId>
        <artifactId>grpc-server-spring-boot-starter</artifactId>
        <version>3.1.0.RELEASE</version>
    </dependency>

    <!-- gRPC Client (Client-side) -->
    <dependency>
        <groupId>net.devh</groupId>
        <artifactId>grpc-client-spring-boot-starter</artifactId>
        <version>3.1.0.RELEASE</version>
    </dependency>

    <!-- Protobuf -->
    <dependency>
        <groupId>com.google.protobuf</groupId>
        <artifactId>protobuf-java</artifactId>
        <version>3.25.1</version>
    </dependency>
</dependencies>

<build>
    <extensions>
        <!-- OS Maven Plugin for protoc -->
        <extension>
            <groupId>kr.motd.maven</groupId>
            <artifactId>os-maven-plugin</artifactId>
            <version>1.7.1</version>
        </extension>
    </extensions>

    <plugins>
        <!-- Protobuf Maven Plugin -->
        <plugin>
            <groupId>org.xolstice.maven.plugins</groupId>
            <artifactId>protobuf-maven-plugin</artifactId>
            <version>0.6.1</version>
            <configuration>
                <protocArtifact>
                    com.google.protobuf:protoc:3.25.1:exe:${os.detected.classifier}
                </protocArtifact>
                <pluginId>grpc-java</pluginId>
                <pluginArtifact>
                    io.grpc:protoc-gen-grpc-java:1.60.0:exe:${os.detected.classifier}
                </pluginArtifact>
            </configuration>
            <executions>
                <execution>
                    <goals>
                        <goal>compile</goal>
                        <goal>compile-custom</goal>
                    </goals>
                </execution>
            </executions>
        </plugin>
    </plugins>
</build>
```

**Gradle (Kotlin DSL):**
```kotlin
plugins {
    id("org.springframework.boot") version "3.2.0"
    id("io.spring.dependency-management") version "1.1.4"
    id("com.google.protobuf") version "0.9.4"
    kotlin("jvm") version "1.9.21"
    kotlin("plugin.spring") version "1.9.21"
}

dependencies {
    implementation("org.springframework.boot:spring-boot-starter")
    implementation("net.devh:grpc-spring-boot-starter:3.1.0.RELEASE")
    implementation("net.devh:grpc-server-spring-boot-starter:3.1.0.RELEASE")
    implementation("net.devh:grpc-client-spring-boot-starter:3.1.0.RELEASE")
    implementation("com.google.protobuf:protobuf-java:3.25.1")
}

protobuf {
    protoc {
        artifact = "com.google.protobuf:protoc:3.25.1"
    }
    plugins {
        create("grpc") {
            artifact = "io.grpc:protoc-gen-grpc-java:1.60.0"
        }
    }
    generateProtoTasks {
        all().forEach {
            it.plugins {
                create("grpc")
            }
        }
    }
}
```

### 2. Define Protobuf Schema

**src/main/proto/order_service.proto:**
```protobuf
syntax = "proto3";

package example.order.v1;

option java_package = "com.example.order.grpc";
option java_multiple_files = true;

service OrderService {
  rpc GetOrder(GetOrderRequest) returns (Order) {}
  rpc CreateOrder(CreateOrderRequest) returns (Order) {}
}

message GetOrderRequest {
  string name = 1;  // Format: orders/{order_id}
}

message CreateOrderRequest {
  string order_id = 1;
  Order order = 2;
}

message Order {
  string name = 1;
  string customer_id = 2;
  OrderStatus status = 3;
  double total = 4;
}

enum OrderStatus {
  ORDER_STATUS_UNSPECIFIED = 0;
  PENDING = 1;
  PROCESSING = 2;
  SHIPPED = 3;
}
```

### 3. Implement gRPC Service

```java
package com.example.order.grpc;

import net.devh.boot.grpc.server.service.GrpcService;
import io.grpc.stub.StreamObserver;
import org.springframework.beans.factory.annotation.Autowired;

@GrpcService
public class OrderServiceImpl extends OrderServiceGrpc.OrderServiceImplBase {

    private final OrderService orderService;

    @Autowired
    public OrderServiceImpl(OrderService orderService) {
        this.orderService = orderService;
    }

    @Override
    public void getOrder(GetOrderRequest request, 
                        StreamObserver<Order> responseObserver) {
        try {
            Order order = orderService.getOrder(request.getName());
            responseObserver.onNext(order);
            responseObserver.onCompleted();
        } catch (OrderNotFoundException e) {
            responseObserver.onError(Status.NOT_FOUND
                .withDescription("Order not found: " + request.getName())
                .asRuntimeException());
        } catch (Exception e) {
            responseObserver.onError(Status.INTERNAL
                .withDescription("Internal server error")
                .asRuntimeException());
        }
    }

    @Override
    public void createOrder(CreateOrderRequest request,
                           StreamObserver<Order> responseObserver) {
        try {
            Order order = orderService.createOrder(
                request.getOrderId(), 
                request.getOrder()
            );
            responseObserver.onNext(order);
            responseObserver.onCompleted();
        } catch (InvalidArgumentException e) {
            responseObserver.onError(Status.INVALID_ARGUMENT
                .withDescription(e.getMessage())
                .asRuntimeException());
        }
    }
}
```

### 4. Configure Application

**src/main/resources/application.yml:**
```yaml
spring:
  application:
    name: order-service

# gRPC Server Configuration
grpc:
  server:
    port: 9090
    # Enable reflection for grpcurl/debugging
    reflection-service-enabled: true
    # Security (optional)
    security:
      enabled: false
    # Connection limits
    max-inbound-message-size: 4MB
    max-inbound-metadata-size: 8KB
    # Keepalive
    keep-alive-time: 30s
    keep-alive-timeout: 10s
    permit-keep-alive-without-calls: true

# gRPC Client Configuration (if calling other services)
grpc:
  client:
    inventory-service:
      address: 'static://inventory-service:9090'
      negotiationType: PLAINTEXT
      # Deadline
      deadline: 30s
      # Keepalive
      enableKeepAlive: true
      keepAliveTime: 30s
      keepAliveTimeout: 10s

# Logging
logging:
  level:
    com.example.order: DEBUG
    net.devh.boot.grpc: INFO
    io.grpc: INFO
```

### 5. Run Application

```java
package com.example.order;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class OrderServiceApplication {
    public static void main(String[] args) {
        SpringApplication.run(OrderServiceApplication.class, args);
    }
}
```

**Test with grpcurl:**
```bash
# List services
grpcurl -plaintext localhost:9090 list

# Call GetOrder
grpcurl -plaintext -d '{"name": "orders/12345"}' \
  localhost:9090 example.order.v1.OrderService/GetOrder
```

---

## Documentation Structure

### Getting Started
- **[Getting Started Guide](getting-started.md)** - Detailed setup walkthrough with Maven and Gradle

### Core Implementation
- **[Server Configuration](server-configuration.md)** - `@GrpcService`, port config, TLS setup
- **[Client Configuration](client-configuration.md)** - `@GrpcClient`, channel management, stubs
- **[Unary Services](unary-services.md)** - Simple request-response patterns (CRUD)
- **[Streaming Services](streaming-services.md)** - Server, client, and bidirectional streaming
- **[Error Handling](error-handling.md)** - Mapping exceptions to gRPC status codes
- **[Interceptors](interceptors.md)** - Global and per-service interceptors (auth, logging, metrics)
- **[Security](security.md)** - Spring Security integration, JWT, OAuth 2.0, TLS

### Testing
- **[Unit Testing](testing/unit-testing.md)** - Testing with InProcessServer and mocks
- **[Integration Testing](testing/integration-testing.md)** - `@SpringBootTest` with embedded gRPC server
- **[Testcontainers](testing/testcontainers.md)** - End-to-end testing with containers

### Observability
- **[Metrics](observability/metrics.md)** - Micrometer integration, custom metrics
- **[Distributed Tracing](observability/tracing.md)** - OpenTelemetry and Zipkin integration
- **[Health Checks](observability/health-checks.md)** - Actuator and grpc.health.v1 integration

### Examples
- **[Complete Service Implementation](examples/OrderServiceImpl.java)** - Production-ready example
- **[Full Configuration](examples/application.yml)** - Complete application.yml with all options

---

## Key Concepts

### @GrpcService Annotation

The `@GrpcService` annotation registers your gRPC service implementation with the Spring container and gRPC server.

```java
@GrpcService
public class OrderServiceImpl extends OrderServiceGrpc.OrderServiceImplBase {
    // Implementation
}
```

**Features:**
- Automatic registration with gRPC server
- Dependency injection support (constructor, field, setter)
- Lifecycle management (initialization, shutdown)
- Compatible with Spring AOP (transactions, caching, etc.)

### @GrpcClient Annotation

The `@GrpcClient` annotation injects a gRPC client stub for calling remote services.

```java
@Service
public class OrderAggregator {

    @GrpcClient("inventory-service")
    private InventoryServiceGrpc.InventoryServiceBlockingStub inventoryStub;

    public OrderWithInventory getOrderWithInventory(String orderId) {
        Order order = getOrder(orderId);
        Inventory inventory = inventoryStub.getInventory(
            GetInventoryRequest.newBuilder()
                .setProductId(order.getProductId())
                .build()
        );
        return combine(order, inventory);
    }
}
```

**Client types:**
- `BlockingStub` - Synchronous calls (simple request-response)
- `Stub` - Asynchronous calls (with callbacks)
- `FutureStub` - Returns `ListenableFuture` (for async composition)

### Interceptors

Interceptors provide cross-cutting concerns for all gRPC calls.

**Server interceptor (applies to all services):**
```java
@GrpcGlobalServerInterceptor
public class LoggingInterceptor implements ServerInterceptor {
    @Override
    public <ReqT, RespT> ServerCall.Listener<ReqT> interceptCall(
        ServerCall<ReqT, RespT> call,
        Metadata headers,
        ServerCallHandler<ReqT, RespT> next) {
        
        log.info("gRPC call: {}", call.getMethodDescriptor().getFullMethodName());
        return next.startCall(call, headers);
    }
}
```

**Client interceptor:**
```java
@Component
public class ClientInterceptorConfig {

    @GrpcGlobalClientInterceptor
    ClientInterceptor authInterceptor() {
        return new ClientInterceptor() {
            @Override
            public <ReqT, RespT> ClientCall<ReqT, RespT> interceptCall(
                MethodDescriptor<ReqT, RespT> method,
                CallOptions callOptions,
                Channel next) {
                
                return new ForwardingClientCall.SimpleForwardingClientCall<ReqT, RespT>(
                    next.newCall(method, callOptions)) {
                    
                    @Override
                    public void start(Listener<RespT> responseListener, Metadata headers) {
                        headers.put(
                            Metadata.Key.of("authorization", Metadata.ASCII_STRING_MARSHALLER),
                            "Bearer " + getToken()
                        );
                        super.start(responseListener, headers);
                    }
                };
            }
        };
    }
}
```

---

## Common Patterns

### Constructor Injection (Recommended)

```java
@GrpcService
public class OrderServiceImpl extends OrderServiceGrpc.OrderServiceImplBase {

    private final OrderRepository repository;
    private final EventPublisher eventPublisher;

    @Autowired
    public OrderServiceImpl(OrderRepository repository, 
                           EventPublisher eventPublisher) {
        this.repository = repository;
        this.eventPublisher = eventPublisher;
    }
}
```

### Exception Handling

```java
@Override
public void createOrder(CreateOrderRequest request,
                       StreamObserver<Order> responseObserver) {
    try {
        validateRequest(request);
        Order order = repository.save(request.getOrder());
        responseObserver.onNext(order);
        responseObserver.onCompleted();
    } catch (ValidationException e) {
        responseObserver.onError(
            Status.INVALID_ARGUMENT
                .withDescription(e.getMessage())
                .asRuntimeException()
        );
    } catch (DuplicateOrderException e) {
        responseObserver.onError(
            Status.ALREADY_EXISTS
                .withDescription("Order already exists")
                .asRuntimeException()
        );
    } catch (Exception e) {
        log.error("Unexpected error creating order", e);
        responseObserver.onError(
            Status.INTERNAL
                .withDescription("Internal server error")
                .asRuntimeException()
        );
    }
}
```

### Async Processing with CompletableFuture

```java
@GrpcService
public class OrderServiceImpl extends OrderServiceGrpc.OrderServiceImplBase {

    @Override
    public void createOrder(CreateOrderRequest request,
                           StreamObserver<Order> responseObserver) {
        
        orderService.createOrderAsync(request)
            .thenAccept(order -> {
                responseObserver.onNext(order);
                responseObserver.onCompleted();
            })
            .exceptionally(throwable -> {
                responseObserver.onError(
                    Status.INTERNAL
                        .withDescription("Internal server error")
                        .asRuntimeException()
                );
                return null;
            });
    }
}
```

---

## Configuration Properties Reference

### Server Properties

```yaml
grpc:
  server:
    # Network
    port: 9090                          # gRPC server port
    address: 0.0.0.0                    # Bind address
    
    # Message limits
    max-inbound-message-size: 4MB       # Maximum message size
    max-inbound-metadata-size: 8KB      # Maximum metadata size
    
    # Connection management
    max-connection-idle: 30m            # Idle connection timeout
    max-connection-age: 30m             # Force reconnect interval
    max-connection-age-grace: 5m        # Grace period for ongoing RPCs
    
    # Keepalive
    keep-alive-time: 2h                 # Keepalive ping interval
    keep-alive-timeout: 20s             # Keepalive timeout
    permit-keep-alive-time: 5m          # Minimum keepalive interval
    permit-keep-alive-without-calls: false
    
    # Security
    security:
      enabled: true
      certificate-chain: classpath:certs/server-cert.pem
      private-key: classpath:certs/server-key.pem
      trust-cert-collection: classpath:certs/ca-cert.pem
      client-auth: REQUIRE               # NONE, OPTIONAL, REQUIRE
    
    # Debugging
    reflection-service-enabled: true    # Enable server reflection
```

### Client Properties

```yaml
grpc:
  client:
    my-service:
      # Address
      address: 'static://localhost:9090'
      # or DNS: 'dns:///my-service:9090'
      # or discovery: 'discovery:///my-service'
      
      negotiationType: PLAINTEXT         # PLAINTEXT, TLS
      
      # Timeouts
      deadline: 30s                      # Per-request deadline
      
      # Keepalive
      enableKeepAlive: true
      keepAliveTime: 30s
      keepAliveTimeout: 10s
      keepAliveWithoutCalls: true
      
      # Retry (requires grpc-java retry support)
      enableRetry: true
      maxRetryAttempts: 3
      
      # Load balancing
      defaultLoadBalancingPolicy: round_robin  # or pick_first
      
      # Security
      security:
        authorityOverride: my-service.example.com
        trustCertCollection: classpath:certs/ca-cert.pem
        clientCertChain: classpath:certs/client-cert.pem
        clientPrivateKey: classpath:certs/client-key.pem
```

---

## Best Practices

### âœ… Do:
- Use constructor injection for dependencies
- Implement proper exception handling with appropriate status codes
- Add global interceptors for cross-cutting concerns (auth, logging, metrics)
- Use `@GrpcService` for service implementations
- Use `@GrpcClient` for client stubs
- Configure timeouts and keepalive appropriately
- Enable server reflection in development (disable in production)
- Use streaming for large datasets or long-running operations
- Test with InProcessServer for fast unit tests

### âŒ Don't:
- Don't block the event loop in async operations
- Don't forget to call `onCompleted()` or `onError()` on `StreamObserver`
- Don't expose internal exceptions to clients (use generic INTERNAL status)
- Don't create new channels for each request (reuse via `@GrpcClient`)
- Don't use blocking I/O in gRPC service methods (use reactive or async)
- Don't ignore security in production (enable TLS and authentication)
- Don't leave reflection enabled in production
- Don't log sensitive data in interceptors

---

## Related Documentation

### Language-Agnostic Theory
- **[gRPC Design Guide](../../../guides/api-design/grpc/README.md)** - Core gRPC concepts and patterns
- **[Protobuf Schema Design](../../../guides/api-design/grpc/protobuf-schema-design.md)** - Schema design best practices
- **[Error Handling](../../../guides/api-design/grpc/error-handling.md)** - Status codes and error details
- **[Security Guide](../../../guides/api-design/grpc/security.md)** - Authentication and authorization

### Other Spring Documentation
- **[Spring Controllers](/languages/spring/controllers/README.md)** - REST API controllers
- **[Spring Security](/languages/spring/security/README.md)** - Security configuration
- **[Spring Testing](/languages/spring/testing/README.md)** - Testing strategies

---

## External Resources

- **[grpc-spring-boot-starter Documentation](https://yidongnan.github.io/grpc-spring-boot-starter/)** - Official library docs
- **[gRPC Java Documentation](https://grpc.io/docs/languages/java/)** - gRPC Java guide
- **[Spring Boot Reference](https://docs.spring.io/spring-boot/docs/current/reference/html/)** - Spring Boot docs

---

**Navigation:** [â† Back to Spring Guide](/languages/spring/README.md) | [Getting Started â†’](getting-started.md)
