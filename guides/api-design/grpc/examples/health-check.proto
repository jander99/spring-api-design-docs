// Copyright 2024 gRPC Authors
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

// Standard gRPC health checking protocol
// Reference: https://github.com/grpc/grpc/blob/master/doc/health-checking.md

syntax = "proto3";

package grpc.health.v1;

option csharp_namespace = "Grpc.Health.V1";
option go_package = "google.golang.org/grpc/health/grpc_health_v1";
option java_multiple_files = true;
option java_outer_classname = "HealthProto";
option java_package = "io.grpc.health.v1";

// Health checking service.
//
// Clients can check service health status and optionally watch for changes.
service Health {
  // Check service health status.
  //
  // If the requested service is unknown, returns status SERVICE_UNKNOWN.
  // If empty string is provided as service name, checks overall server health.
  rpc Check(HealthCheckRequest) returns (HealthCheckResponse);

  // Watch service health status changes.
  //
  // Server streams health status updates whenever the status changes.
  // Initial status is sent immediately.
  rpc Watch(HealthCheckRequest) returns (stream HealthCheckResponse);
}

// Health check request.
message HealthCheckRequest {
  // Service name to check.
  //
  // If empty string, checks overall server health.
  // Format: fully-qualified service name (e.g., "orders.v1.OrderService").
  string service = 1;
}

// Health check response.
message HealthCheckResponse {
  // Service health status.
  enum ServingStatus {
    // Health status unknown.
    // Used during initialization or when unable to determine status.
    UNKNOWN = 0;

    // Service is healthy and accepting requests.
    SERVING = 1;

    // Service is unhealthy and not accepting requests.
    // May be temporary (e.g., startup, overload) or permanent (e.g., shutdown).
    NOT_SERVING = 2;

    // Service name not recognized by this server.
    // Returned when checking a service that doesn't exist.
    SERVICE_UNKNOWN = 3;  // Used only by the Watch method.
  }

  // Current serving status.
  ServingStatus status = 1;
}

// Usage Examples:
//
// 1. Check overall server health:
//    Request: HealthCheckRequest { service: "" }
//    Response: HealthCheckResponse { status: SERVING }
//
// 2. Check specific service health:
//    Request: HealthCheckRequest { service: "orders.v1.OrderService" }
//    Response: HealthCheckResponse { status: SERVING }
//
// 3. Watch for status changes:
//    Request: HealthCheckRequest { service: "orders.v1.OrderService" }
//    Stream:
//      Response 1: HealthCheckResponse { status: SERVING }
//      (service becomes unhealthy)
//      Response 2: HealthCheckResponse { status: NOT_SERVING }
//      (service recovers)
//      Response 3: HealthCheckResponse { status: SERVING }
//
// 4. Unknown service:
//    Request: HealthCheckRequest { service: "nonexistent.Service" }
//    Response: HealthCheckResponse { status: SERVICE_UNKNOWN }
